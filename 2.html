<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="碳吉 TanJi - 全台首創社區氣候韌性與 NbS 決策平台，協助管委會進行氣候風險快篩與自然解方規劃。">
    <title>碳吉 TanJi - 社區微氣候韌性與 NbS 決策平台</title>
    
    <!-- 引入 Tailwind CSS (快速排版) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 Font Awesome (圖示) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- 引入 Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- 引入 docx.js (文件生成) -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <!-- 引入 FileSaver.js (檔案下載) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            green: '#059669', // Emerald 600
                            light: '#d1fae5', // Emerald 100
                            dark: '#064e3b',  // Emerald 900
                            blue: '#0ea5e9',  // Sky 500
                        }
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* 自定義動畫與樣式 */
        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .hero-pattern {
            background-color: #f8fafc;
            background-image: radial-gradient(#059669 0.5px, transparent 0.5px), radial-gradient(#059669 0.5px, #f8fafc 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.5;
        }

        .toggle-checkbox:checked {
            right: 0;
            border-color: #059669;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #059669;
        }
        
        /* 載入動畫 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #059669;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bar-transition {
            transition: width 1s ease-in-out, background-color 0.5s;
        }
    </style>
</head>
<body class="font-sans text-slate-800 antialiased bg-slate-50">

    <!-- Navigation -->
    <nav class="glass-nav fixed w-full z-50 top-0 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center gap-3 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="w-10 h-10 bg-gradient-to-br from-brand-green to-brand-blue rounded-lg flex items-center justify-center text-white font-bold text-xl">
                        <i class="fa-solid fa-leaf"></i>
                    </div>
                    <span class="font-bold text-2xl tracking-tight text-slate-800">碳吉 <span class="text-brand-green font-light">TanJi</span></span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="#features" class="text-slate-600 hover:text-brand-green font-medium transition">核心功能</a>
                    <a href="#demo-scan" class="text-slate-600 hover:text-brand-green font-medium transition">風險快篩</a>
                    <a href="#demo-sim" class="text-slate-600 hover:text-brand-green font-medium transition">效益模擬</a>
                    <a href="#impact" class="text-slate-600 hover:text-brand-green font-medium transition">預期成果</a>
                </div>
                <div>
                    <a href="#demo-scan" class="bg-slate-900 hover:bg-slate-800 text-white px-6 py-2.5 rounded-full font-medium transition shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        開始免費診斷
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden">
        <div class="absolute inset-0 hero-pattern -z-10"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            
            <h1 class="text-5xl md:text-7xl font-extrabold text-slate-900 tracking-tight mb-8 leading-tight">
                為您的社區穿上<br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-green to-brand-blue">綠色氣候防護衣</span>
            </h1>
            <p class="max-w-2xl mx-auto text-xl text-slate-600 mb-10 leading-relaxed">
                TanJi 是全台首創的社區氣候韌性決策平台。結合 GIS 大數據與 NbS 自然解方，
                協助管委會從「風險診斷」到「改造補助」一站式完成。
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button onclick="document.getElementById('demo-scan').scrollIntoView({behavior: 'smooth'})" class="px-8 py-4 bg-brand-green hover:bg-emerald-600 text-white text-lg font-bold rounded-xl shadow-lg shadow-emerald-200 transition transform hover:scale-105 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-magnifying-glass-location"></i>
                    檢測我的社區
                </button>
                <button onclick="document.getElementById('features').scrollIntoView({behavior: 'smooth'})" class="px-8 py-4 bg-white hover:bg-slate-50 text-slate-700 border border-slate-200 text-lg font-bold rounded-xl shadow-sm transition flex items-center justify-center gap-2">
                    <i class="fa-solid fa-play"></i>
                    觀看運作流程
                </button>
            </div>
            
            <!-- Platform Concept Explainer (Replaced Dashboard) -->
            <div class="mt-16 relative mx-auto max-w-5xl rounded-2xl shadow-2xl border border-slate-200 overflow-hidden bg-white">
                <div class="bg-gradient-to-r from-slate-50 to-white p-8 md:p-12">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                        <!-- Text Description Side -->
                        <div class="w-full md:w-1/2 text-left space-y-6">
                            <h3 class="text-2xl font-bold text-slate-800">TanJi 平台運作邏輯</h3>
                            <p class="text-slate-600 text-lg">
                                專為社區管委會設計的氣候調適數位助理。我們不只告訴您「哪裡熱」，更直接提供「怎麼解」的科學方案。
                            </p>
                            <ul class="space-y-4">
                                <li class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                        <i class="fa-solid fa-database"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold text-slate-800">1. 數據匯流 (Data Ingestion)</div>
                                        <div class="text-sm text-slate-500">串接氣象局與新北市GIS圖資</div>
                                    </div>
                                </li>
                                <li class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600">
                                        <i class="fa-solid fa-magnifying-glass-chart"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold text-slate-800">2. 風險指認 (Risk ID)</div>
                                        <div class="text-sm text-slate-500">AI 判讀都市熱島熱點與 NCDR 淹水潛勢圖</div>
                                    </div>
                                </li>
                                <li class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-brand-light flex items-center justify-center text-brand-green">
                                        <i class="fa-solid fa-tree"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold text-slate-800">3. 自然解方 (NbS)</div>
                                        <div class="text-sm text-slate-500">推薦適地適種的 NbS 植栽組合</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <!-- Visual Diagram Side -->
                        <div class="w-full md:w-1/2 bg-slate-100 rounded-xl p-6 relative">
                            <!-- Visual Diagram -->
                            <div class="relative z-10 grid grid-cols-2 gap-4">
                                <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                                    <i class="fa-solid fa-cloud-rain text-3xl text-blue-500 mb-2"></i>
                                    <div class="font-bold text-sm">氣候數據</div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                                    <i class="fa-solid fa-building text-3xl text-slate-500 mb-2"></i>
                                    <div class="font-bold text-sm">建築圖資</div>
                                </div>
                                <div class="col-span-2 bg-brand-green text-white p-4 rounded-lg shadow-lg text-center transform scale-105">
                                    <i class="fa-solid fa-microchip text-3xl mb-2"></i>
                                    <div class="font-bold text-lg">TanJi AI 核心引擎</div>
                                    <div class="text-xs opacity-80 mt-1">熱點分析 | 效益模擬 | 計畫生成</div>
                                </div>
                                <div class="col-span-2 bg-white p-4 rounded-lg shadow-sm text-center border-t-4 border-brand-green">
                                    <div class="font-bold text-brand-dark">行動計畫書 (Action Plan)</div>
                                    <div class="text-xs text-slate-500 mt-1">補助申請 / 施工規範 / 維護手冊</div>
                                </div>
                            </div>
                            <!-- Background Decoration -->
                            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')] opacity-10"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Grid -->
    <section id="features" class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-base text-brand-green font-bold tracking-wide uppercase">System Features</h2>
                <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-slate-900 sm:text-4xl">
                    氣候行動的最後一哩路
                </p>
                <p class="mt-4 max-w-2xl text-xl text-slate-500 mx-auto">
                    我們將複雜的氣候科學與繁瑣的行政流程，轉化為簡單直覺的數位工具。
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <!-- Card 1 -->
                <div class="bg-slate-50 rounded-2xl p-8 border border-slate-100 hover:border-brand-green transition group cursor-pointer hover:shadow-xl">
                    <div class="w-14 h-14 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center text-2xl mb-6 group-hover:scale-110 transition">
                        <i class="fa-solid fa-map-location-dot"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 mb-3">1. 氣候風險快篩</h3>
                    <p class="text-slate-600 leading-relaxed">
                        整合 GIS 圖資，輸入地址即可辨識社區是否位於「熱島中心」或「淹水潛勢區」，精準指認改造熱點。
                    </p>
                </div>
                <!-- Card 2 -->
                <div class="bg-slate-50 rounded-2xl p-8 border border-slate-100 hover:border-brand-green transition group cursor-pointer hover:shadow-xl">
                    <div class="w-14 h-14 bg-green-100 text-green-600 rounded-xl flex items-center justify-center text-2xl mb-6 group-hover:scale-110 transition">
                        <i class="fa-solid fa-store"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 mb-3">2. NbS 選物店</h3>
                    <p class="text-slate-600 leading-relaxed">
                        模組化的自然解方（NbS）資料庫。針對屋頂、中庭、牆面提供適地適種的植栽建議與工程模組。
                    </p>
                </div>
                <!-- Card 3 -->
                <div class="bg-slate-50 rounded-2xl p-8 border border-slate-100 hover:border-brand-green transition group cursor-pointer hover:shadow-xl">
                    <div class="w-14 h-14 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center text-2xl mb-6 group-hover:scale-110 transition">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 mb-3">3. 自動生成計畫</h3>
                    <p class="text-slate-600 leading-relaxed">
                        再也不用煩惱文書作業。系統自動將模擬數據填入「低碳標章」與「改造補助」申請書，一鍵匯出 Word 檔。
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Demo Section 1: Risk Scan -->
    <section id="demo-scan" class="py-20 bg-slate-900 text-white relative overflow-hidden">
        <!-- Background Decoration -->
        <div class="absolute top-0 left-0 w-64 h-64 bg-brand-green rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
        <div class="absolute bottom-0 right-0 w-64 h-64 bg-brand-blue rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>

        <div class="max-w-4xl mx-auto px-4 relative z-10">
            <div class="text-center mb-12">
                <span class="text-brand-green font-bold tracking-wider uppercase text-sm">Interactive Demo 01</span>
                <h2 class="text-3xl md:text-4xl font-bold mt-2">試試看：社區風險快篩</h2>
                <p class="text-slate-400 mt-4">輸入新北市地址，體驗 AI 診斷流程</p>
            </div>

            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20 shadow-2xl">
                <!-- Search Bar -->
                <div class="flex flex-col sm:flex-row gap-4 mb-8">
                    <div class="flex-grow relative">
                        <i class="fa-solid fa-location-dot absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                        <input type="text" id="address-input" value="新北市三峽區學勤路1號 (北大特區)" class="w-full bg-slate-800 border border-slate-600 rounded-lg py-4 pl-12 pr-4 text-white placeholder-slate-500 focus:outline-none focus:border-brand-green transition" placeholder="請輸入新北市社區地址...">
                    </div>
                    <button onclick="startAnalysis()" class="bg-brand-green hover:bg-emerald-600 text-white font-bold py-4 px-8 rounded-lg transition shadow-lg flex items-center justify-center gap-2 min-w-[160px]">
                        <span id="btn-text">開始分析</span>
                        <div id="btn-loader" class="loader hidden w-5 h-5 border-2 border-white border-t-transparent"></div>
                    </button>
                </div>
                
                <!-- Data Source Indicator (New Feature) -->
                <div class="mb-6 flex flex-wrap gap-2 justify-center text-xs text-slate-400">
                    <div class="api-status flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full border border-white/10 transition-colors duration-300">
                        <div class="status-dot w-2 h-2 rounded-full bg-slate-500"></div> 串接：新北市門牌位置資料庫
                    </div>
                    <div class="api-status flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full border border-white/10 transition-colors duration-300">
                        <div class="status-dot w-2 h-2 rounded-full bg-slate-500"></div> 串接：NCDR 災害潛勢地圖 API
                    </div>
                    <div class="api-status flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full border border-white/10 transition-colors duration-300">
                        <div class="status-dot w-2 h-2 rounded-full bg-slate-500"></div> 串接：CWA 氣象觀測開放資料
                    </div>
                </div>
                
                <!-- Status Message Area -->
                <div id="status-message" class="text-center text-sm text-brand-green font-mono h-6 mb-4 opacity-0 transition-opacity">
                    正在連線至 API...
                </div>

                <!-- Analysis Result (Initially Hidden) -->
                <div id="analysis-result" class="hidden transition-all duration-500 opacity-0 transform translate-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Map Placeholder -->
                        <div class="bg-slate-800 rounded-xl overflow-hidden h-64 relative border border-slate-700 flex items-center justify-center">
                            <!-- Simulated Map View -->
                            <div class="absolute inset-0 bg-slate-700">
                                <div class="w-full h-full opacity-30" style="background-image: repeating-linear-gradient(45deg, #475569 0, #475569 1px, transparent 0, transparent 50%); background-size: 10px 10px;"></div>
                            </div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <i class="fa-solid fa-map-location-dot text-6xl text-slate-600"></i>
                            </div>
                             <!-- Heatmap Overlay Effect -->
                            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-red-500 rounded-full filter blur-2xl opacity-40"></div>

                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg animate-pulse z-10">
                                    <i class="fa-solid fa-circle-exclamation mr-1"></i> <span id="map-alert-text">熱島效應熱點</span>
                                </span>
                            </div>
                        </div>
                        
                        <!-- Data Cards -->
                        <div class="space-y-4">
                            <!-- Temp Card -->
                            <div class="bg-red-500/20 border border-red-500/50 p-4 rounded-xl flex items-start gap-4">
                                <div class="bg-red-500 p-2 rounded-lg text-white"><i class="fa-solid fa-temperature-full"></i></div>
                                <div>
                                    <h4 class="font-bold text-red-200" id="result-temp-title">極度高溫警示 (板橋區)</h4>
                                    <p class="text-sm text-slate-300 mt-1" id="result-temp-desc">該區域 7 月地表均溫達 38.2°C，高於新北市平均 2.5°C。</p>
                                    <p class="text-xs text-slate-400 mt-1" id="api-debug-info"></p>
                                </div>
                            </div>
                            <!-- Flood Card -->
                            <div class="bg-blue-500/20 border border-blue-500/50 p-4 rounded-xl flex items-start gap-4">
                                <div class="bg-blue-500 p-2 rounded-lg text-white"><i class="fa-solid fa-cloud-showers-heavy"></i></div>
                                <div>
                                    <h4 class="font-bold text-blue-200" id="result-flood-title">排水負荷警示</h4>
                                    <p class="text-sm text-slate-300 mt-1" id="result-flood-desc">短延時強降雨發生機率高，建議提升社區透水率。</p>
                                </div>
                            </div>
                            <!-- Action Button -->
                            <div class="bg-brand-green p-4 rounded-xl text-center cursor-pointer hover:bg-emerald-600 transition" onclick="document.getElementById('demo-sim').scrollIntoView({behavior: 'smooth'})">
                                <p class="font-bold text-white"><i class="fa-solid fa-arrow-right mr-2"></i> 前往 NbS 模擬器改善</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Demo Section 2: Simulator & Plan Generation -->
    <section id="demo-sim" class="py-20 bg-slate-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row gap-12 items-start">
                
                <!-- Left: Controls -->
                <div class="w-full md:w-1/3 space-y-8 sticky top-24">
                    
                    <!-- Header -->
                    <div>
                        <span class="text-brand-green font-bold tracking-wider uppercase text-sm">Interactive Demo 02</span>
                        <h2 class="text-3xl font-bold mt-2 text-slate-900">NbS 效益模擬器</h2>
                        <p class="text-slate-600 mt-4" id="sim-desc">
                            試著輸入施作面積並開啟模擬，系統將自動計算經費與減碳效益，並生成計畫書。
                        </p>
                    </div>

                    <!-- Control Panel -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-6">
                        
                        <!-- 1. 輸入面積 -->
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">預計施作面積 (坪)</label>
                            <div class="relative">
                                <input type="number" id="sim-area" value="30" oninput="updateCalculations()" class="w-full border border-slate-300 rounded-lg py-2 px-4 focus:ring-2 focus:ring-brand-green focus:border-transparent outline-none transition font-mono text-lg text-right">
                                <span class="absolute left-4 top-2.5 text-slate-400 text-sm"><i class="fa-solid fa-ruler-combined"></i></span>
                            </div>
                        </div>

                        <!-- 2. 開關模擬 -->
                        <div class="flex items-center justify-between">
                            <span class="font-bold text-slate-700">啟用 NbS 改造模擬</span>
                            <div class="relative inline-block w-14 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="sim-toggle" class="toggle-checkbox absolute block w-8 h-8 rounded-full bg-white border-4 border-slate-300 appearance-none cursor-pointer transition-all duration-300 top-[-4px] left-[-4px]" onchange="toggleSimulation()"/>
                                <label for="sim-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer"></label>
                            </div>
                        </div>

                        <!-- 3. 即時經費試算 (顯示區) -->
                        <div id="cost-preview" class="hidden bg-slate-50 p-4 rounded-xl border border-slate-200 text-sm space-y-3 animate-pulse-fast" style="animation-iteration-count: 1;">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">預估總經費</span>
                                <span class="font-bold text-slate-800 text-lg" id="val-total-cost">$0</span>
                            </div>
                            <div class="flex justify-between items-center text-brand-green">
                                <span><i class="fa-solid fa-hand-holding-dollar mr-1"></i> 政府補助 (約50%)</span>
                                <span class="font-bold text-lg" id="val-subsidy">$0</span>
                            </div>
                            <div class="flex justify-between items-center border-t border-slate-200 pt-3">
                                <span class="text-slate-500">預估回收年限</span>
                                <span class="font-bold text-slate-800" id="val-roi">-- 年</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Button (一鍵生成) -->
                    <button id="btn-generate" onclick="generateSubsidyDoc()" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa-solid fa-file-signature"></i>
                        一鍵生成改造補助計畫書
                    </button>
                    <p class="text-center text-xs text-slate-400 mt-2">* 系統將自動生成符合新北市環保局格式之 Word 檔</p>
                </div>

                <!-- Right: Visualizer -->
                <div class="w-full md:w-2/3 bg-white rounded-3xl shadow-xl p-8 border border-slate-100 relative overflow-hidden">
                    <!-- Before/After Image (Concept) -->
                    <div class="h-80 rounded-xl bg-slate-200 mb-8 overflow-hidden relative group">
                        <!-- Image A: Concrete (Using a placeholder color/icon for stability) -->
                        <div id="img-before" class="absolute inset-0 w-full h-full bg-slate-400 flex items-center justify-center transition-opacity duration-700">
                            <div class="text-center">
                                <i class="fa-solid fa-layer-group text-6xl text-slate-600 mb-2"></i>
                                <p class="text-slate-200 font-bold text-xl">原始水泥屋頂</p>
                            </div>
                        </div>
                        
                        <!-- Image B: Green (Using a placeholder color/icon for stability) -->
                        <div id="img-after" class="absolute inset-0 w-full h-full bg-emerald-600 flex items-center justify-center opacity-0 transition-opacity duration-700">
                             <div class="text-center">
                                <i class="fa-solid fa-seedling text-6xl text-white mb-2"></i>
                                <p class="text-white font-bold text-xl">導入綠屋頂後</p>
                            </div>
                        </div>
                        
                        <div class="absolute bottom-4 left-4 bg-black/60 text-white px-3 py-1 rounded text-sm backdrop-blur transition-colors duration-500" id="img-badge">
                            <span id="img-label">原始現況</span>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="space-y-8">
                        <!-- Temp Bar -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-base font-bold text-slate-600"><i class="fa-solid fa-temperature-high mr-2"></i>頂樓夏季表面溫度</span>
                                <span id="val-temp" class="text-base font-bold text-red-500">55°C</span>
                            </div>
                            <div class="w-full bg-slate-100 rounded-full h-6">
                                <div id="bar-temp" class="bg-red-500 h-6 rounded-full bar-transition shadow-sm" style="width: 95%"></div>
                            </div>
                            <p class="text-xs text-slate-400 mt-1">*依據新北市夏季實測數據推估</p>
                        </div>

                        <!-- Carbon Bar -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-base font-bold text-slate-600"><i class="fa-solid fa-bolt mr-2"></i>年節電效益 (預估)</span>
                                <span id="val-carbon" class="text-base font-bold text-slate-400">0 度</span>
                            </div>
                            <div class="w-full bg-slate-100 rounded-full h-6">
                                <div id="bar-carbon" class="bg-brand-green h-6 rounded-full bar-transition shadow-sm" style="width: 2%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-leaf text-brand-green"></i>
                        <span class="font-bold text-xl">碳吉 TanJi</span>
                    </div>
                    <p class="text-slate-400 text-sm">教育部 115 年度氣候變遷創意實作競賽參賽隊伍</p>
                    <p class="text-slate-400 text-sm">國立臺北大學團隊 製作</p>
                </div>
                <div class="flex gap-6">
                    <a href="#" class="text-slate-400 hover:text-white transition"><i class="fa-brands fa-github text-2xl"></i></a>
                    <a href="#" class="text-slate-400 hover:text-white transition"><i class="fa-solid fa-envelope text-2xl"></i></a>
                </div>
            </div>
            <div class="border-t border-slate-800 mt-8 pt-8 text-center text-slate-500 text-sm">
                &copy; 2026 TanJi Project. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Scripts for Interactivity -->
    <script>
        // --- REAL DATA MOCK CONFIGURATION ---
        // 模擬真實 API 回傳數據 - 專注於北大特區 (三峽/樹林交界)
        
        const MOCK_DB = {
            "北大": {
                district: "北大特區",
                temp: 36.8, 
                avgTemp: 1.8, 
                floodRisk: "中",
                floodDesc: "位處三峽/樹林交界，高密度大樓群導致微氣候均溫偏高。",
                nbsSuggestion: "屋頂薄層綠化 + 中庭雨水花園",
                cost: 25000, // 每坪單價
                apiDebug: "API Response: { district: '北大特區', road: '學勤路', x: 288456, y: 2756123 }"
            },
            "板橋": {
                district: "板橋區",
                temp: 38.2, 
                avgTemp: 2.5, 
                floodRisk: "高",
                floodDesc: "短延時強降雨發生機率高，地勢低窪，排水需特別注意。",
                nbsSuggestion: "薄層綠屋頂 + 透水磚",
                cost: 28000,
                apiDebug: "API Response: { district: '板橋區', road: '中山路', x: 295678, y: 2768901 }"
            },
            "default": {
                district: "新北市",
                temp: 37.0,
                avgTemp: 1.5,
                floodRisk: "中",
                floodDesc: "都市化程度高，建議優先降低不透水鋪面。",
                nbsSuggestion: "綜合型生態綠化",
                cost: 25000,
                apiDebug: "API Response: { status: 'OK', results: 10 }"
            }
        };

        let currentData = MOCK_DB["北大"]; // 預設為北大特區

        // Constants for Calculation
        const ELECTRICITY_RATE = 4.5; // 每度電費 (假設)
        const CO2_COEF = 0.495; // 排碳係數

        // Feature 1: Map Analysis Logic (with Simulated API Calls)
        function startAnalysis() {
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            const resultDiv = document.getElementById('analysis-result');
            const inputVal = document.getElementById('address-input').value;
            const statusMsg = document.getElementById('status-message');
            const statusDots = document.querySelectorAll('.status-dot');
            const statusContainers = document.querySelectorAll('.api-status');
            
            // 1. Determine which data to use based on input
            if (inputVal.includes("板橋")) currentData = MOCK_DB["板橋"];
            else if (inputVal.includes("三峽") || inputVal.includes("學勤") || inputVal.includes("北大")) currentData = MOCK_DB["北大"];
            else currentData = MOCK_DB["北大"]; // 預設回傳北大特區資料

            // 2. UI Loading State
            btnText.innerText = '分析中...';
            btnLoader.classList.remove('hidden');
            resultDiv.classList.add('hidden', 'opacity-0');
            statusMsg.classList.remove('opacity-0');
            
            // 3. Simulate API Connection Steps
            // Step 1: Geocoding (Address -> Lat/Lon)
            statusMsg.innerText = "正在連線新北市門牌資料庫...";
            statusContainers[0].classList.add('bg-brand-green/20', 'border-brand-green/50');
            statusDots[0].classList.replace('bg-slate-500', 'bg-brand-green');
            statusDots[0].classList.add('animate-pulse-fast');

            setTimeout(() => {
                // Step 2: NCDR Flood Data
                statusMsg.innerText = "取得 NCDR 災害潛勢圖資...";
                statusDots[0].classList.remove('animate-pulse-fast');
                statusContainers[1].classList.add('bg-brand-green/20', 'border-brand-green/50');
                statusDots[1].classList.replace('bg-slate-500', 'bg-brand-green');
                statusDots[1].classList.add('animate-pulse-fast');
            }, 800);

            setTimeout(() => {
                // Step 3: CWA Weather Data
                statusMsg.innerText = "下載 CWA 氣象觀測資料...";
                statusDots[1].classList.remove('animate-pulse-fast');
                statusContainers[2].classList.add('bg-brand-green/20', 'border-brand-green/50');
                statusDots[2].classList.replace('bg-slate-500', 'bg-brand-green');
                statusDots[2].classList.add('animate-pulse-fast');
            }, 1600);

            setTimeout(() => {
                // Finalize
                statusMsg.innerText = "AI 運算完成！";
                statusDots[2].classList.remove('animate-pulse-fast');
                
                // Update UI with "Real" Mock Data
                updateRiskUI(currentData);

                // Reset Button & Show Result
                btnText.innerText = '重新分析';
                btnLoader.classList.add('hidden');
                resultDiv.classList.remove('hidden');
                
                setTimeout(() => {
                    resultDiv.classList.remove('opacity-0', 'translate-y-4');
                }, 50);
                
            }, 2400);
        }

        function updateRiskUI(data) {
            // Update Temp Card
            document.getElementById('result-temp-title').innerText = `極度高溫警示 (${data.district})`;
            document.getElementById('result-temp-desc').innerText = `該區域夏季地表均溫達 ${data.temp}°C，高於平均 ${data.avgTemp}°C。`;
            document.getElementById('api-debug-info').innerText = data.apiDebug;
            
            // Update Flood Card
            document.getElementById('result-flood-title').innerText = `排水負荷警示 (${data.floodRisk}風險)`;
            document.getElementById('result-flood-desc').innerText = data.floodDesc;

            // Update Simulation Intro Text
            document.getElementById('sim-desc').innerText = `針對您的${data.district}社區環境，我們建議建置「${data.nbsSuggestion}」。請輸入預計施作面積，開啟模擬以計算經費。`;
        }

        // Feature 2: Simulation & Calculation Logic
        function updateCalculations() {
            const area = parseInt(document.getElementById('sim-area').value) || 0;
            const isToggled = document.getElementById('sim-toggle').checked;
            const costPreview = document.getElementById('cost-preview');
            const generateBtn = document.getElementById('btn-generate');

            if (!isToggled) {
                costPreview.classList.add('hidden');
                generateBtn.disabled = true;
                return;
            }

            costPreview.classList.remove('hidden');
            generateBtn.disabled = false;

            // 經費計算
            const totalCost = area * currentData.cost;
            const subsidy = Math.floor(totalCost * 0.5); // 補助上限 50%
            
            // 效益計算 (假設每坪綠屋頂每年省電 60 度 - 參數化)
            const annualPowerSave = area * 60; 
            const annualMoneySave = annualPowerSave * ELECTRICITY_RATE;
            
            // 回收年限 = (總價 - 補助) / 年省電費
            const roi = annualMoneySave > 0 ? ((totalCost - subsidy) / annualMoneySave).toFixed(1) : "N/A";

            // 更新數字 UI
            document.getElementById('val-total-cost').innerText = `NT$ ${totalCost.toLocaleString()}`;
            document.getElementById('val-subsidy').innerText = `NT$ ${subsidy.toLocaleString()}`;
            document.getElementById('val-roi').innerText = `${roi} 年`;
            
            // 更新圖表 Bar
            const barCarbon = document.getElementById('bar-carbon');
            const valCarbon = document.getElementById('val-carbon');
            
            // 動態調整 Bar 寬度 (設定一個 max 值做比例，例如 300坪為滿格)
            const maxPowerSave = 300 * 60; 
            const percentage = Math.min((annualPowerSave / maxPowerSave) * 100, 100);
            
            barCarbon.style.width = Math.max(percentage, 5) + '%';
            barCarbon.classList.remove('bg-slate-300');
            barCarbon.classList.add('bg-brand-green');
            
            valCarbon.innerText = `${annualPowerSave.toLocaleString()} 度`;
            valCarbon.classList.remove('text-slate-400');
            valCarbon.classList.add('text-brand-green');
        }

        function toggleSimulation() {
            const isChecked = document.getElementById('sim-toggle').checked;
            
            // Elements
            const label = document.getElementById('toggle-status'); // removed in new design but kept var for safety
            const imgBefore = document.getElementById('img-before');
            const imgAfter = document.getElementById('img-after');
            const imgLabel = document.getElementById('img-label');
            const imgBadge = document.getElementById('img-badge');
            
            const barTemp = document.getElementById('bar-temp');
            const valTemp = document.getElementById('val-temp');
            
            // Use current mock data
            const highTemp = currentData.temp; 
            const lowTemp = (currentData.temp - 4.5).toFixed(1);

            if (isChecked) {
                // State: Improved
                imgAfter.classList.remove('opacity-0');
                imgLabel.innerText = '模擬效果';
                imgBadge.classList.replace('bg-black/60', 'bg-brand-green/90');

                // Update Temp Chart 
                barTemp.style.width = '50%'; 
                barTemp.classList.replace('bg-red-500', 'bg-brand-green');
                valTemp.innerText = `${lowTemp}°C`;
                valTemp.classList.replace('text-red-500', 'text-brand-green');

            } else {
                // State: Original
                imgAfter.classList.add('opacity-0');
                imgLabel.innerText = '原始現況';
                imgBadge.classList.replace('bg-brand-green/90', 'bg-black/60');

                // Reset Temp Chart
                barTemp.style.width = '95%'; 
                barTemp.classList.replace('bg-brand-green', 'bg-red-500');
                valTemp.innerText = `${highTemp}°C`;
                valTemp.classList.replace('text-brand-green', 'text-red-500');
                
                // Reset Carbon Chart (in updateCalculations)
                const barCarbon = document.getElementById('bar-carbon');
                const valCarbon = document.getElementById('val-carbon');
                barCarbon.style.width = '2%';
                barCarbon.classList.remove('bg-brand-green');
                barCarbon.classList.add('bg-slate-300');
                valCarbon.innerText = '0 度';
                valCarbon.classList.remove('text-brand-green');
                valCarbon.classList.add('text-slate-400');
            }
            
            // Trigger calculation update
            updateCalculations();
        }

        // Feature 3: Generate Document (docx.js)
        function generateSubsidyDoc() {
            // 1. 獲取當前模擬數據
            const address = document.getElementById('address-input').value || "新北市某社區";
            const area = document.getElementById('sim-area').value || "0";
            const totalCostStr = document.getElementById('val-total-cost').innerText;
            const subsidyStr = document.getElementById('val-subsidy').innerText;
            const roiStr = document.getElementById('val-roi').innerText;
            const annualSave = document.getElementById('val-carbon').innerText;
            
            const itemName = currentData.nbsSuggestion || "薄層綠屋頂";
            const itemDesc = `於社區頂樓施作${itemName}，面積共 ${area} 坪。採用原生耐旱植栽，設置自動澆灌系統。`;

            // 2. 使用 docx.js 構建文檔
            const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType, AlignmentType, Header, Footer, TextRun, BorderStyle } = docx;

            // 定義表格樣式 helper
            const cellStyle = {
                borders: {
                    top: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                    bottom: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                    left: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                    right: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                },
                margins: { top: 100, bottom: 100, left: 100, right: 100 }
            };

            const doc = new Document({
                sections: [{
                    properties: {},
                    children: [
                        // 標題
                        new Paragraph({
                            text: "114年度新北市低碳社區改造補助計畫申請表",
                            heading: docx.HeadingLevel.HEADING_1,
                            alignment: AlignmentType.CENTER,
                            spacing: { after: 400 }
                        }),

                        // 基本資料區
                        new Table({
                            width: { size: 100, type: WidthType.PERCENTAGE },
                            rows: [
                                new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph({text: "申請單位", bold: true})], ...cellStyle, width: {size: 30, type: WidthType.PERCENTAGE} }),
                                    new TableCell({ children: [new Paragraph(address)], ...cellStyle }),
                                ]}),
                                new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph({text: "改造項目", bold: true})], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph(itemName)], ...cellStyle }),
                                ]}),
                            ]
                        }),

                        new Paragraph({ text: "", spacing: { after: 400 } }),

                        // 改造內容
                        new Paragraph({ text: "一、現況說明與改善方式", heading: docx.HeadingLevel.HEADING_2, spacing: { after: 200 } }),
                        new Paragraph({ text: itemDesc, spacing: { after: 400 } }),

                        // 經費表格
                        new Paragraph({ text: "二、經費評估與預估效益", heading: docx.HeadingLevel.HEADING_2, spacing: { after: 200 } }),
                        new Table({
                            width: { size: 100, type: WidthType.PERCENTAGE },
                            rows: [
                                new TableRow({ 
                                    children: [
                                        new TableCell({ children: [new Paragraph({text: "項目", bold: true, alignment: AlignmentType.CENTER})], ...cellStyle, shading: {fill: "EEEEEE"} }),
                                        new TableCell({ children: [new Paragraph({text: "數值", bold: true, alignment: AlignmentType.CENTER})], ...cellStyle, shading: {fill: "EEEEEE"} }),
                                        new TableCell({ children: [new Paragraph({text: "說明", bold: true, alignment: AlignmentType.CENTER})], ...cellStyle, shading: {fill: "EEEEEE"} }),
                                    ]
                                }),
                                new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph("施作面積")], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph(`${area} 坪`)], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph("預計改造範圍")], ...cellStyle }),
                                ]}),
                                new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph("預估總經費")], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph(totalCostStr)], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph("含工資與稅金")], ...cellStyle }),
                                ]}),
                                 new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph("申請補助金額")], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph(subsidyStr)], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph("申請最高 50%")], ...cellStyle }),
                                ]}),
                                new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph("預估年省電量")], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph(annualSave)], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph("依據模擬推估")], ...cellStyle }),
                                ]}),
                                new TableRow({ children: [
                                    new TableCell({ children: [new Paragraph("預估回收年限")], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph(roiStr)], ...cellStyle }),
                                    new TableCell({ children: [new Paragraph("投資效益分析")], ...cellStyle }),
                                ]}),
                            ]
                        }),

                        new Paragraph({ 
                            text: "\n※ 本計畫書由 TanJi 碳吉決策平台 AI 自動生成，僅供申請參考。", 
                            alignment: AlignmentType.CENTER,
                            color: "808080",
                            spacing: { before: 600 }
                        })
                    ]
                }]
            });

            // 3. 下載檔案
            Packer.toBlob(doc).then(blob => {
                saveAs(blob, `${address}_改造補助計畫書_草案.docx`);
            });
        }
    </script>
</body>
</html>
